<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç§äººæ­Œå•ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/auth.css" />
    <style>
      /* æ­Œå•æ“ä½œæŒ‰é’® */
      .playlist-actions {
        margin-top: 20px;
        text-align: center;
      }

      #create-playlist-btn {
        background-color: transparent;
        border: 1px dashed var(--primary-color);
        color: var(--primary-color);
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
      }

      #create-playlist-btn:hover {
        background-color: rgba(142, 68, 173, 0.1);
      }

      /* æ¨¡æ€æ¡†æ ·å¼ */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }

      .modal-content {
        background-color: white;
        margin: 15% auto;
        padding: 20px;
        border-radius: 8px;
        width: 80%;
        max-width: 500px;
        position: relative;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .close-button {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        cursor: pointer;
        color: #aaa;
      }

      .close-button:hover {
        color: #333;
      }

      /* è¡¨å•æ ·å¼ */
      #create-playlist-form .form-group {
        margin-bottom: 15px;
      }

      #create-playlist-form label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }

      #create-playlist-form input,
      #create-playlist-form textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      #create-playlist-form textarea {
        min-height: 80px;
        resize: vertical;
      }

      #create-playlist-form .form-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 20px;
      }

      .btn {
        padding: 8px 15px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-weight: 500;
        margin-left: 10px;
      }

      .primary-btn {
        background-color: var(--primary-color);
        color: white;
      }

      .secondary-btn {
        background-color: #f0f0f0;
        color: #333;
      }

      /* æ­Œæ›²è¡¨æ ¼æ ·å¼ */
      .song-table tbody tr {
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .song-table tbody tr:hover {
        background-color: rgba(142, 68, 173, 0.05);
      }

      .song-table tbody tr.playing {
        background-color: rgba(142, 68, 173, 0.1);
        font-weight: 500;
      }

      .song-table tbody tr.playing td:first-child::before {
        content: "â–¶";
        font-size: 10px;
        margin-right: 5px;
        color: var(--primary-color);
      }
    </style>
  </head>
  <body>
    <!-- å¯¼èˆªæ  -->
    <header>
      <div class="container">
        <nav>
          <div class="logo">ç§äººæ­Œå•</div>
          <ul class="nav-links">
            <li><a href="#">é¦–é¡µ</a></li>
            <li><a href="#">æ­Œå•ç®¡ç†</a></li>
            <li><a href="#">æ™ºèƒ½æ¨è</a></li>
            <li><a href="#">æ•°æ®ç»Ÿè®¡</a></li>
            <li><a href="#" class="login-btn">ç™»å½•</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒº -->
    <section class="hero">
      <div class="container">
        <h1>ç»Ÿä¸€ç®¡ç†ä½ çš„æœ¬åœ°éŸ³ä¹åº“</h1>
        <p>
          æ™ºèƒ½è§£ææœ¬åœ°éŸ³ä¹æ–‡ä»¶ï¼Œè·¨å¹³å°æ•´åˆéŸ³ä¹èµ„æºï¼Œåˆ›å»ºä¸ªæ€§åŒ–æ­Œå•ï¼Œäº«å—é«˜å“è´¨çš„éŸ³ä¹ä½“éªŒã€‚
        </p>
        <div class="hero-buttons">
          <a href="#" class="cta-btn" id="upload-music-btn">ä¸Šä¼ éŸ³ä¹</a>
          <a href="#" class="cta-btn cta-secondary">äº†è§£æ›´å¤š</a>
        </div>
      </div>
    </section>

    <!-- åŠŸèƒ½å±•ç¤ºåŒº -->
    <section class="features">
      <div class="container">
        <div class="section-title">
          <h2>æ ¸å¿ƒåŠŸèƒ½</h2>
          <p>ä¸ºæœ¬åœ°éŸ³ä¹æ–‡ä»¶æ‰“é€ çš„ä¸€ä½“åŒ–ç®¡ç†è§£å†³æ–¹æ¡ˆ</p>
        </div>
        <div class="feature-grid">
          <div class="feature-card">
            <div class="feature-icon">ğŸ“Š</div>
            <h3>æ™ºèƒ½è§£æ</h3>
            <p>
              æ”¯æŒMP3/FLAC/WAVå…ƒæ•°æ®æå–ï¼Œè‡ªåŠ¨è¯†åˆ«ä¸“è¾‘å°é¢ï¼Œç²¾å‡†åˆ†æéŸ³ä¹é£æ ¼ä¸BPMã€‚
            </p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸ“</div>
            <h3>æ­Œå•å·¥åŠ</h3>
            <p>
              æ‹–æ‹½å¼æ­Œå•ç¼–è¾‘ï¼Œæ™ºèƒ½æ ‡ç­¾ç³»ç»Ÿï¼Œæ”¯æŒå¤šç»´åº¦æ’åºç­›é€‰ï¼Œæ‰“é€ å®Œç¾æ­Œå•ä½“éªŒã€‚
            </p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸµ</div>
            <h3>æœ¬åœ°æ’­æ”¾</h3>
            <p>
              æ— æŸéŸ³é¢‘è§£ç ï¼Œå¯è§†åŒ–éŸ³æ•ˆè°ƒèŠ‚ï¼Œæ”¯æŒç¦»çº¿æ­Œè¯åŒæ­¥ï¼Œä½“éªŒé«˜å“è´¨éŸ³ä¹æ’­æ”¾ã€‚
            </p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸ”</div>
            <h3>æ•°æ®æ´å¯Ÿ</h3>
            <p>
              å¬æ­Œä¹ æƒ¯åˆ†æï¼ŒéŸ³ä¹åŸºå› å›¾è°±ï¼Œå¹´åº¦å¬æ­ŒæŠ¥å‘Šï¼Œæ·±å…¥äº†è§£ä½ çš„éŸ³ä¹å“å‘³ã€‚
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- æ­Œå•å±•ç¤ºåŒº -->
    <section class="playlist-section">
      <div class="container">
        <div class="section-title">
          <h2>æ­Œå•ç®¡ç†</h2>
          <p>æ•´åˆç®¡ç†ä½ çš„éŸ³ä¹æ”¶è—</p>
        </div>
        <div class="playlist-container">
          <div class="playlist-sidebar">
            <h3 class="sidebar-title">æˆ‘çš„æ­Œå•</h3>
            <ul class="playlist-list">
              <li class="active">æœ€çˆ±æ”¶è—</li>
              <li>æµè¡Œçƒ­æ­Œ</li>
              <li>è½»éŸ³ä¹</li>
              <li>è¿åŠ¨åŠ¨åŠ›</li>
              <li>å·¥ä½œä¸“æ³¨</li>
              <li>ç¡å‰æ”¾æ¾</li>
            </ul>
            <div class="playlist-actions">
              <button id="create-playlist-btn">æ–°å»ºæ­Œå•</button>
            </div>
          </div>
          <div class="song-container">
            <div class="song-header">
              <h3>æœ€çˆ±æ”¶è—</h3>
              <div class="song-actions">
                <button id="add-song-btn">æ·»åŠ æ­Œæ›²</button>
                <button id="recommend-btn">æ™ºèƒ½æ¨è</button>
              </div>
            </div>
            <table class="song-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>æ­Œæ›²å</th>
                  <th>è‰ºæœ¯å®¶</th>
                  <th>ä¸“è¾‘</th>
                  <th>æ—¶é•¿</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td>æ˜¥é£åé‡Œ</td>
                  <td>é¹¿å…ˆæ£®ä¹é˜Ÿ</td>
                  <td>æ‰€æœ‰çš„é…’ï¼Œéƒ½ä¸å¦‚ä½ </td>
                  <td>5:28</td>
                  <td>â™¡</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>è«æ–¯ç§‘æ²¡æœ‰çœ¼æ³ª</td>
                  <td>æå¥</td>
                  <td>ä¼¼æ°´æµå¹´</td>
                  <td>4:36</td>
                  <td>â™¡</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>æ¶ˆæ„</td>
                  <td>æ¯›ä¸æ˜“</td>
                  <td>å¹³å‡¡çš„ä¸€å¤©</td>
                  <td>4:09</td>
                  <td>â™¡</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>èŠ’ç§</td>
                  <td>éŸ³é˜™è¯—å¬/èµµæ–¹å©§</td>
                  <td>èŠ’ç§</td>
                  <td>3:36</td>
                  <td>â™¡</td>
                </tr>
                <tr>
                  <td>5</td>
                  <td>èµ·é£äº†</td>
                  <td>ä¹°è¾£æ¤’ä¹Ÿç”¨åˆ¸</td>
                  <td>èµ·é£äº†</td>
                  <td>5:11</td>
                  <td>â™¡</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- æ’­æ”¾å™¨æ§åˆ¶æ  -->
    <div class="player-bar">
      <div class="now-playing">
        <div class="album-art"></div>
        <div class="track-info">
          <h4>æ¶ˆæ„</h4>
          <p>æ¯›ä¸æ˜“ - å¹³å‡¡çš„ä¸€å¤©</p>
        </div>
      </div>
      <div class="player-controls">
        <button class="control-btn">â®</button>
        <button class="control-btn" style="font-size: 2rem">â–¶</button>
        <button class="control-btn">â­</button>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress"></div>
        </div>
        <div class="time-info">
          <span>1:32</span>
          <span>4:09</span>
        </div>
      </div>
    </div>

    <!-- æ–°å»ºæ­Œå•å¯¹è¯æ¡† -->
    <div id="create-playlist-modal" class="modal">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>åˆ›å»ºæ–°æ­Œå•</h2>
        <form id="create-playlist-form">
          <div class="form-group">
            <label for="playlist-name">æ­Œå•åç§°</label>
            <input
              type="text"
              id="playlist-name"
              required
              placeholder="è¯·è¾“å…¥æ­Œå•åç§°"
            />
          </div>
          <div class="form-group">
            <label for="playlist-desc">æ­Œå•æè¿°</label>
            <textarea
              id="playlist-desc"
              placeholder="æè¿°è¿™ä¸ªæ­Œå•..."
            ></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn primary-btn">åˆ›å»º</button>
            <button type="button" class="btn secondary-btn cancel-btn">
              å–æ¶ˆ
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- é¡µè„š -->
    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-info">
            <div class="footer-logo">ç§äººæ­Œå•</div>
            <p class="footer-description">
              ä¸ºéŸ³ä¹çˆ±å¥½è€…æ‰“é€ çš„æœ¬åœ°éŸ³ä¹ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œè®©éŸ³ä¹å›å½’ç§äººä½“éªŒã€‚
            </p>
            <div class="social-links">
              <a href="#" class="social-link">å¾®</a>
              <a href="#" class="social-link">å¾®</a>
              <a href="#" class="social-link">çŸ¥</a>
              <a href="#" class="social-link">æŠ–</a>
            </div>
          </div>
          <div class="footer-links">
            <h3>äº§å“</h3>
            <ul>
              <li><a href="#">åŠŸèƒ½ä»‹ç»</a></li>
              <li><a href="#">æŠ€æœ¯æ”¯æŒ</a></li>
              <li><a href="#">æ›´æ–°æ—¥å¿—</a></li>
              <li><a href="#">è·¯çº¿å›¾</a></li>
            </ul>
          </div>
          <div class="footer-links">
            <h3>èµ„æº</h3>
            <ul>
              <li><a href="#">ä½¿ç”¨æ–‡æ¡£</a></li>
              <li><a href="#">å¸¸è§é—®é¢˜</a></li>
              <li><a href="#">å¼€å‘è€…æ–‡æ¡£</a></li>
              <li><a href="#">APIæ¥å£</a></li>
            </ul>
          </div>
          <div class="footer-links">
            <h3>å…³äºæˆ‘ä»¬</h3>
            <ul>
              <li><a href="#">å›¢é˜Ÿä»‹ç»</a></li>
              <li><a href="#">è”ç³»æˆ‘ä»¬</a></li>
              <li><a href="#">åŠ å…¥æˆ‘ä»¬</a></li>
              <li><a href="#">éšç§æ”¿ç­–</a></li>
            </ul>
          </div>
        </div>
        <div class="copyright">&copy; 2024 dedicated-proç»„ç»‡ ç‰ˆæƒæ‰€æœ‰</div>
      </div>
    </footer>

    <!-- JavaScript -->
    <script type="module">
      // ç”±äºæ¨¡å—å¯¼å…¥åœ¨æ™®é€šHTMLä¸­éœ€è¦ç±»å‹ä¸ºmodule
      import AuthManager from "./js/auth.js";
      import MusicUploader from "./js/upload.js";
      import MusicPlayer from "./js/player.js";

      // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ‰€æœ‰æ¨¡å—
      document.addEventListener("DOMContentLoaded", () => {
        // åˆå§‹åŒ–è®¤è¯ç®¡ç†å™¨
        const authManager = new AuthManager();

        // åˆå§‹åŒ–éŸ³ä¹ä¸Šä¼ å™¨
        const musicUploader = new MusicUploader();

        // éŸ³ä¹æ’­æ”¾å™¨é…ç½®
        const playerConfig = {
          onSongEnd: () => {
            // æ’­æ”¾ä¸‹ä¸€é¦–
            if (currentPlaylist.length > 0) {
              if (currentIndex < currentPlaylist.length - 1) {
                currentIndex++;
              } else {
                currentIndex = 0; // å¾ªç¯æ’­æ”¾
              }
              musicPlayer.loadSong(currentPlaylist[currentIndex]);
              highlightCurrentSong();
            }
          },
        };

        // åˆå§‹åŒ–éŸ³ä¹æ’­æ”¾å™¨
        const musicPlayer = new MusicPlayer(playerConfig);

        // å­˜å‚¨å½“å‰æ’­æ”¾åˆ—è¡¨å’Œç´¢å¼•
        let currentPlaylist = [];
        let currentIndex = -1;

        // éŸ³ä¹ä¸Šä¼ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document
          .getElementById("upload-music-btn")
          .addEventListener("click", (e) => {
            e.preventDefault();

            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            if (!authManager.isLoggedIn()) {
              alert("è¯·å…ˆç™»å½•åå†ä¸Šä¼ éŸ³ä¹");
              // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
              authManager.showLoginModal();
              return;
            }

            // å·²ç™»å½•ï¼Œè°ƒç”¨ä¸Šä¼ åŠŸèƒ½
            musicUploader.showFileSelector((uploadedSongs) => {
              // ä¸Šä¼ æˆåŠŸåï¼Œæ·»åŠ åˆ°å½“å‰æ­Œå•
              console.log("æˆåŠŸä¸Šä¼ éŸ³ä¹æ–‡ä»¶:", uploadedSongs);

              // æ›´æ–°ç•Œé¢
              updateSongTable(uploadedSongs);

              // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
              alert(`æˆåŠŸä¸Šä¼  ${uploadedSongs.length} é¦–æ­Œæ›²åˆ°å½“å‰æ­Œå•ï¼`);
            });
          });

        // æ·»åŠ æ­Œæ›²æŒ‰é’®ä¹Ÿéœ€è¦ç™»å½•éªŒè¯
        document
          .getElementById("add-song-btn")
          .addEventListener("click", () => {
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            if (!authManager.isLoggedIn()) {
              alert("è¯·å…ˆç™»å½•åå†æ·»åŠ æ­Œæ›²");
              // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
              authManager.showLoginModal();
              return;
            }

            // å·²ç™»å½•ï¼Œè°ƒç”¨ä¸Šä¼ åŠŸèƒ½
            musicUploader.showFileSelector((uploadedSongs) => {
              // ä¸Šä¼ æˆåŠŸåï¼Œæ·»åŠ åˆ°å½“å‰æ­Œå•
              console.log("æˆåŠŸæ·»åŠ éŸ³ä¹æ–‡ä»¶:", uploadedSongs);

              // æ›´æ–°ç•Œé¢
              updateSongTable(uploadedSongs);

              // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
              alert(`æˆåŠŸæ·»åŠ  ${uploadedSongs.length} é¦–æ­Œæ›²åˆ°å½“å‰æ­Œå•ï¼`);
            });
          });

        // åˆ›å»ºæ–°æ­Œå•æŒ‰é’®äº‹ä»¶
        document
          .getElementById("create-playlist-btn")
          .addEventListener("click", () => {
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            if (!authManager.isLoggedIn()) {
              alert("è¯·å…ˆç™»å½•åå†åˆ›å»ºæ­Œå•");
              // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
              authManager.showLoginModal();
              return;
            }

            // æ˜¾ç¤ºåˆ›å»ºæ­Œå•å¯¹è¯æ¡†
            const modal = document.getElementById("create-playlist-modal");
            modal.style.display = "block";
          });

        // å…³é—­æ¨¡æ€æ¡†äº‹ä»¶
        document
          .querySelectorAll(".close-button, .cancel-btn")
          .forEach((element) => {
            element.addEventListener("click", () => {
              document.getElementById("create-playlist-modal").style.display =
                "none";
            });
          });

        // åˆ›å»ºæ­Œå•è¡¨å•æäº¤
        document
          .getElementById("create-playlist-form")
          .addEventListener("submit", (e) => {
            e.preventDefault();

            const playlistName = document.getElementById("playlist-name").value;
            const playlistDesc = document.getElementById("playlist-desc").value;

            if (!playlistName.trim()) {
              alert("æ­Œå•åç§°ä¸èƒ½ä¸ºç©ºï¼");
              return;
            }

            // åˆ›å»ºæ–°æ­Œå•
            addPlaylistToUI(playlistName);
            document.getElementById("playlist-name").value = "";
            document.getElementById("playlist-desc").value = "";
            document.getElementById("create-playlist-modal").style.display =
              "none";
          });

        // æ‰‹åŠ¨æ·»åŠ æ­Œå•åˆ°UI
        function addPlaylistToUI(name) {
          const li = document.createElement("li");
          li.textContent = name;
          li.addEventListener("click", function () {
            document
              .querySelectorAll(".playlist-list li")
              .forEach((item) => item.classList.remove("active"));
            this.classList.add("active");
            document.querySelector(".song-header h3").textContent = name;

            // æ¸…ç©ºæ­Œæ›²åˆ—è¡¨ï¼ˆæ–°å»ºçš„æ­Œå•æ²¡æœ‰æ­Œæ›²ï¼‰
            document.querySelector(".song-table tbody").innerHTML = "";

            // æ¸…ç©ºå½“å‰æ’­æ”¾åˆ—è¡¨
            currentPlaylist = [];
            currentIndex = -1;
          });
          document.querySelector(".playlist-list").appendChild(li);
        }

        // æ›´æ–°æ­Œæ›²è¡¨æ ¼
        function updateSongTable(songs) {
          if (!songs || songs.length === 0) return;

          const tbody = document.querySelector(".song-table tbody");

          // æ·»åŠ æ–°ä¸Šä¼ çš„æ­Œæ›²
          songs.forEach((song, index) => {
            const row = document.createElement("tr");

            // æ ¼å¼åŒ–æ—¶é•¿ï¼ˆç§’è½¬mm:ssï¼‰
            const duration = song.duration || 0;
            const mins = Math.floor(duration / 60);
            const secs = Math.floor(duration % 60);
            const formattedDuration = `${mins}:${secs < 10 ? "0" : ""}${secs}`;

            row.innerHTML = `
              <td>${tbody.children.length + index + 1}</td>
              <td>${song.title}</td>
              <td>${song.artist}</td>
              <td>${song.album}</td>
              <td>${formattedDuration}</td>
              <td>â™¡</td>
            `;

            // æ·»åŠ åˆ°å½“å‰æ’­æ”¾åˆ—è¡¨
            currentPlaylist.push(song);

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            row.addEventListener("click", function () {
              // è·å–å½“å‰æ­Œæ›²åœ¨åˆ—è¡¨ä¸­çš„ç´¢å¼•
              const songIndex = Array.from(tbody.children).indexOf(this);
              currentIndex = songIndex;

              // ä½¿ç”¨MusicPlayeråŠ è½½å¹¶æ’­æ”¾æ­Œæ›²
              musicPlayer.loadSong(currentPlaylist[currentIndex]);
              highlightCurrentSong();
            });

            tbody.appendChild(row);
          });
        }

        // æ§åˆ¶æŒ‰é’®äº‹ä»¶å¤„ç†
        const playButton = document.querySelector(
          ".player-controls .control-btn:nth-child(2)"
        );
        const prevButton = document.querySelector(
          ".player-controls .control-btn:nth-child(1)"
        );
        const nextButton = document.querySelector(
          ".player-controls .control-btn:nth-child(3)"
        );

        // æ’­æ”¾/æš‚åœæŒ‰é’® - éœ€è¦åœ¨è¿™é‡Œç»‘å®šäº‹ä»¶ï¼Œå› ä¸ºåœ¨MusicPlayerç±»ä¸­å·²å­˜åœ¨é‡å¤ç»‘å®š
        playButton.addEventListener("click", () => {
          if (currentIndex >= 0 && currentPlaylist.length > 0) {
            // å¦‚æœå½“å‰æœ‰æ­Œæ›²æ­£åœ¨æ’­æ”¾ï¼Œåˆ™åˆ‡æ¢æ’­æ”¾/æš‚åœçŠ¶æ€
            musicPlayer.togglePlay();
          } else if (currentPlaylist.length > 0) {
            // å¦‚æœæœ‰æ­Œæ›²ä½†æ²¡æœ‰æ’­æ”¾ï¼Œæ’­æ”¾ç¬¬ä¸€é¦–
            currentIndex = 0;
            musicPlayer.loadSong(currentPlaylist[currentIndex]);
            highlightCurrentSong();
          }
        });

        // ä¸Šä¸€é¦–æŒ‰é’®
        prevButton.addEventListener("click", () => {
          if (currentPlaylist.length > 0) {
            if (currentIndex > 0) {
              currentIndex--;
            } else {
              // å¾ªç¯åˆ°æœ€åä¸€é¦–
              currentIndex = currentPlaylist.length - 1;
            }
            musicPlayer.loadSong(currentPlaylist[currentIndex]);

            // é«˜äº®æ˜¾ç¤ºå½“å‰æ’­æ”¾çš„æ­Œæ›²è¡Œ
            highlightCurrentSong();
          }
        });

        // ä¸‹ä¸€é¦–æŒ‰é’®
        nextButton.addEventListener("click", () => {
          if (currentPlaylist.length > 0) {
            if (currentIndex < currentPlaylist.length - 1) {
              currentIndex++;
            } else {
              // å¾ªç¯åˆ°ç¬¬ä¸€é¦–
              currentIndex = 0;
            }
            musicPlayer.loadSong(currentPlaylist[currentIndex]);

            // é«˜äº®æ˜¾ç¤ºå½“å‰æ’­æ”¾çš„æ­Œæ›²è¡Œ
            highlightCurrentSong();
          }
        });

        // é«˜äº®æ˜¾ç¤ºå½“å‰æ’­æ”¾çš„æ­Œæ›²è¡Œ
        function highlightCurrentSong() {
          const rows = document.querySelectorAll(".song-table tbody tr");
          rows.forEach((row, index) => {
            if (index === currentIndex) {
              row.classList.add("playing");
            } else {
              row.classList.remove("playing");
            }
          });
        }

        // é¢„åŠ è½½musicæ–‡ä»¶å¤¹ä¸­çš„éŸ³ä¹
        function preloadLocalMusic() {
          if (authManager.isLoggedIn()) {
            const musicFiles = [
              {
                name: "call of silence.mp3",
                path: "music/call of silence.mp3",
              },
              {
                name: "è¾¾å°”æ–‡-æ—ä¿Šæ°-JJçš„å’–å•¡è°ƒè°ƒ.mp3",
                path: "music/è¾¾å°”æ–‡-æ—ä¿Šæ°-JJçš„å’–å•¡è°ƒè°ƒ.mp3",
              },
            ];

            // åŠ è½½ç¬¬ä¸€é¦–æ­Œæ›²
            fetch(musicFiles[0].path)
              .then((response) => response.blob())
              .then((blob) => {
                const file1 = new File([blob], musicFiles[0].name, {
                  type: "audio/mpeg",
                });

                // åŠ è½½ç¬¬äºŒé¦–æ­Œæ›²
                return fetch(musicFiles[1].path)
                  .then((response) => response.blob())
                  .then((blob) => {
                    const file2 = new File([blob], musicFiles[1].name, {
                      type: "audio/mpeg",
                    });
                    return [file1, file2];
                  });
              })
              .then((files) => {
                // å¤„ç†æ–‡ä»¶
                musicUploader.processFiles(files).then((songs) => {
                  updateSongTable(songs);
                  console.log("æˆåŠŸåŠ è½½æœ¬åœ°éŸ³ä¹æ–‡ä»¶", songs);
                });
              })
              .catch((error) => {
                console.error("åŠ è½½æœ¬åœ°éŸ³ä¹æ–‡ä»¶å¤±è´¥:", error);
              });
          }
        }

        // è‡ªåŠ¨åŠ è½½æœ¬åœ°éŸ³ä¹
        document
          .getElementById("add-song-btn")
          .addEventListener("click", function () {
            if (authManager.isLoggedIn()) {
              preloadLocalMusic();
            }
          });
      });
    </script>
    <script src="js/main.js"></script>
  </body>
</html>
