<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç§äººæ­Œå•ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/auth.css" />
    <style>
      /* æ­Œå•æ“ä½œæŒ‰é’® */
      .playlist-actions {
        margin-top: 20px;
        text-align: center;
      }

      #create-playlist-btn {
        background-color: transparent;
        border: 1px dashed var(--primary-color);
        color: var(--primary-color);
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
      }

      #create-playlist-btn:hover {
        background-color: rgba(142, 68, 173, 0.1);
      }

      /* æ­Œå•åˆ—è¡¨å®¹å™¨æ ·å¼ */
      .playlist-sidebar {
        width: 250px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        display: flex;
        flex-direction: column;
        height: calc(100vh - 300px);
        min-height: 400px;
        max-height: 800px;
      }

      .sidebar-title {
        margin: 0 0 15px 0;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--primary-color);
        color: #333;
        font-size: 1.2em;
      }

      .playlist-list {
        list-style: none;
        padding: 0;
        margin: 0;
        overflow-y: auto;
        flex-grow: 1;
      }

      /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
      .playlist-list::-webkit-scrollbar {
        width: 6px;
      }

      .playlist-list::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
      }

      .playlist-list::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 3px;
      }

      .playlist-list::-webkit-scrollbar-thumb:hover {
        background: #aaa;
      }

      .playlist-list li {
        padding: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        border-radius: 4px;
        margin-bottom: 2px;
      }

      .playlist-list li:hover {
        background-color: rgba(142, 68, 173, 0.05);
      }

      .playlist-list li.active {
        background-color: rgba(142, 68, 173, 0.1);
        color: var(--primary-color);
        font-weight: 500;
      }

      /* å¹³å°æ­Œå•æ ·å¼ */
      .platform-title {
        font-weight: bold;
        color: #333;
        padding: 10px 0 5px 0;
        margin-top: 10px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        cursor: default;
      }

      .platform-title:first-child {
        margin-top: 0;
      }

      .platform-playlist {
        padding-left: 15px !important;
        font-size: 0.95em;
        position: relative;
      }

      .platform-playlist::before {
        content: "â€¢";
        position: absolute;
        left: 5px;
        color: #888;
      }

      /* æ­Œå•å®¹å™¨å¸ƒå±€ */
      .playlist-container {
        display: flex;
        gap: 20px;
        margin-top: 20px;
      }

      .song-container {
        flex-grow: 1;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
      }

      /* æ¨¡æ€æ¡†æ ·å¼ */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }

      .modal-content {
        background-color: white;
        margin: 15% auto;
        padding: 20px;
        border-radius: 8px;
        width: 80%;
        max-width: 500px;
        position: relative;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .close-button {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        cursor: pointer;
        color: #aaa;
      }

      .close-button:hover {
        color: #333;
      }

      /* è¡¨å•æ ·å¼ */
      #create-playlist-form .form-group {
        margin-bottom: 15px;
      }

      #create-playlist-form label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }

      #create-playlist-form input,
      #create-playlist-form textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      #create-playlist-form textarea {
        min-height: 80px;
        resize: vertical;
      }

      #create-playlist-form .form-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 20px;
      }

      .btn {
        padding: 8px 15px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-weight: 500;
        margin-left: 10px;
      }

      .primary-btn {
        background-color: var(--primary-color);
        color: white;
      }

      .secondary-btn {
        background-color: #f0f0f0;
        color: #333;
      }

      /* æ­Œæ›²è¡¨æ ¼æ ·å¼ */
      .song-table tbody tr {
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .song-table tbody tr:hover {
        background-color: rgba(142, 68, 173, 0.05);
      }

      .song-table tbody tr.playing {
        background-color: rgba(142, 68, 173, 0.1);
        font-weight: 500;
      }

      .song-table tbody tr.playing td:first-child::before {
        content: "â–¶";
        font-size: 10px;
        margin-right: 5px;
        color: var(--primary-color);
      }
    </style>
  </head>
  <body>
    <!-- å¯¼èˆªæ  -->
    <header>
      <div class="container">
        <nav>
          <div class="logo">ç§äººæ­Œå•</div>
          <ul class="nav-links">
            <li><a href="#">é¦–é¡µ</a></li>
            <li><a href="#">æ­Œå•ç®¡ç†</a></li>
            <li><a href="#">æ™ºèƒ½æ¨è</a></li>
            <li><a href="#">æ•°æ®ç»Ÿè®¡</a></li>
            <li><a href="#" class="login-btn">ç™»å½•</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒº -->
    <section class="hero">
      <div class="container">
        <h1>ç»Ÿä¸€ç®¡ç†ä½ çš„æœ¬åœ°éŸ³ä¹åº“</h1>
        <p>
          æ™ºèƒ½è§£ææœ¬åœ°éŸ³ä¹æ–‡ä»¶ï¼Œè·¨å¹³å°æ•´åˆéŸ³ä¹èµ„æºï¼Œåˆ›å»ºä¸ªæ€§åŒ–æ­Œå•ï¼Œäº«å—é«˜å“è´¨çš„éŸ³ä¹ä½“éªŒã€‚
        </p>
        <div class="hero-buttons">
          <a href="#" class="cta-btn" id="upload-music-btn">ä¸Šä¼ éŸ³ä¹</a>
          <a href="#" class="cta-btn cta-secondary">äº†è§£æ›´å¤š</a>
        </div>
      </div>
    </section>

    <!-- åŠŸèƒ½å±•ç¤ºåŒº -->
    <section class="features">
      <div class="container">
        <div class="section-title">
          <h2>æ ¸å¿ƒåŠŸèƒ½</h2>
          <p>ä¸ºæœ¬åœ°éŸ³ä¹æ–‡ä»¶æ‰“é€ çš„ä¸€ä½“åŒ–ç®¡ç†è§£å†³æ–¹æ¡ˆ</p>
        </div>
        <div class="feature-grid">
          <div class="feature-card">
            <div class="feature-icon">ğŸ“Š</div>
            <h3>æ™ºèƒ½è§£æ</h3>
            <p>
              æ”¯æŒMP3/FLAC/WAVå…ƒæ•°æ®æå–ï¼Œè‡ªåŠ¨è¯†åˆ«ä¸“è¾‘å°é¢ï¼Œç²¾å‡†åˆ†æéŸ³ä¹é£æ ¼ä¸BPMã€‚
            </p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸ“</div>
            <h3>æ­Œå•å·¥åŠ</h3>
            <p>
              æ‹–æ‹½å¼æ­Œå•ç¼–è¾‘ï¼Œæ™ºèƒ½æ ‡ç­¾ç³»ç»Ÿï¼Œæ”¯æŒå¤šç»´åº¦æ’åºç­›é€‰ï¼Œæ‰“é€ å®Œç¾æ­Œå•ä½“éªŒã€‚
            </p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸµ</div>
            <h3>æœ¬åœ°æ’­æ”¾</h3>
            <p>
              æ— æŸéŸ³é¢‘è§£ç ï¼Œå¯è§†åŒ–éŸ³æ•ˆè°ƒèŠ‚ï¼Œæ”¯æŒç¦»çº¿æ­Œè¯åŒæ­¥ï¼Œä½“éªŒé«˜å“è´¨éŸ³ä¹æ’­æ”¾ã€‚
            </p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸ”</div>
            <h3>æ•°æ®æ´å¯Ÿ</h3>
            <p>
              å¬æ­Œä¹ æƒ¯åˆ†æï¼ŒéŸ³ä¹åŸºå› å›¾è°±ï¼Œå¹´åº¦å¬æ­ŒæŠ¥å‘Šï¼Œæ·±å…¥äº†è§£ä½ çš„éŸ³ä¹å“å‘³ã€‚
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- æ­Œå•å±•ç¤ºåŒº -->
    <section class="playlist-section">
      <div class="container">
        <div class="section-title">
          <h2>æ­Œå•ç®¡ç†</h2>
          <p>æ•´åˆç®¡ç†ä½ çš„éŸ³ä¹æ”¶è—</p>
        </div>
        <div class="playlist-container">
          <div class="playlist-sidebar">
            <h3 class="sidebar-title">æˆ‘çš„æ­Œå•</h3>
            <ul class="playlist-list">
              <li class="active">æœ€çˆ±æ”¶è—</li>
              <li>æµè¡Œçƒ­æ­Œ</li>
              <li>è½»éŸ³ä¹</li>
              <li>è¿åŠ¨åŠ¨åŠ›</li>
              <li>å·¥ä½œä¸“æ³¨</li>
              <li>ç¡å‰æ”¾æ¾</li>
            </ul>
            <div class="playlist-actions">
              <button id="create-playlist-btn">æ–°å»ºæ­Œå•</button>
            </div>
          </div>
          <div class="song-container">
            <div class="song-header">
              <h3>æœ€çˆ±æ”¶è—</h3>
              <div class="song-actions">
                <button id="add-song-btn">æ·»åŠ æ­Œæ›²</button>
                <button id="recommend-btn">æ™ºèƒ½æ¨è</button>
              </div>
            </div>
            <table class="song-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>æ­Œæ›²å</th>
                  <th>è‰ºæœ¯å®¶</th>
                  <th>ä¸“è¾‘</th>
                  <th>æ—¶é•¿</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td>æ˜¥é£åé‡Œ</td>
                  <td>é¹¿å…ˆæ£®ä¹é˜Ÿ</td>
                  <td>æ‰€æœ‰çš„é…’ï¼Œéƒ½ä¸å¦‚ä½ </td>
                  <td>5:28</td>
                  <td>â™¡</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>è«æ–¯ç§‘æ²¡æœ‰çœ¼æ³ª</td>
                  <td>æå¥</td>
                  <td>ä¼¼æ°´æµå¹´</td>
                  <td>4:36</td>
                  <td>â™¡</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>æ¶ˆæ„</td>
                  <td>æ¯›ä¸æ˜“</td>
                  <td>å¹³å‡¡çš„ä¸€å¤©</td>
                  <td>4:09</td>
                  <td>â™¡</td>
                </tr>
                <tr>
                  <td>4</td>
                  <td>èŠ’ç§</td>
                  <td>éŸ³é˜™è¯—å¬/èµµæ–¹å©§</td>
                  <td>èŠ’ç§</td>
                  <td>3:36</td>
                  <td>â™¡</td>
                </tr>
                <tr>
                  <td>5</td>
                  <td>èµ·é£äº†</td>
                  <td>ä¹°è¾£æ¤’ä¹Ÿç”¨åˆ¸</td>
                  <td>èµ·é£äº†</td>
                  <td>5:11</td>
                  <td>â™¡</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- æ’­æ”¾å™¨æ§åˆ¶æ  -->
    <div class="player-bar">
      <div class="now-playing">
        <div class="album-art"></div>
        <div class="track-info">
          <h4>æ¶ˆæ„</h4>
          <p>æ¯›ä¸æ˜“ - å¹³å‡¡çš„ä¸€å¤©</p>
        </div>
      </div>
      <div class="player-controls">
        <button class="control-btn">â®</button>
        <button class="control-btn" style="font-size: 2rem">â–¶</button>
        <button class="control-btn">â­</button>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress"></div>
        </div>
        <div class="time-info">
          <span>1:32</span>
          <span>4:09</span>
        </div>
      </div>
    </div>

    <!-- æ–°å»ºæ­Œå•å¯¹è¯æ¡† -->
    <div id="create-playlist-modal" class="modal">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>åˆ›å»ºæ–°æ­Œå•</h2>
        <form id="create-playlist-form">
          <div class="form-group">
            <label for="playlist-name">æ­Œå•åç§°</label>
            <input
              type="text"
              id="playlist-name"
              required
              placeholder="è¯·è¾“å…¥æ­Œå•åç§°"
            />
          </div>
          <div class="form-group">
            <label for="playlist-desc">æ­Œå•æè¿°</label>
            <textarea
              id="playlist-desc"
              placeholder="æè¿°è¿™ä¸ªæ­Œå•..."
            ></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn primary-btn">åˆ›å»º</button>
            <button type="button" class="btn secondary-btn cancel-btn">
              å–æ¶ˆ
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- é¡µè„š -->
    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-info">
            <div class="footer-logo">ç§äººæ­Œå•</div>
            <p class="footer-description">
              ä¸ºéŸ³ä¹çˆ±å¥½è€…æ‰“é€ çš„æœ¬åœ°éŸ³ä¹ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œè®©éŸ³ä¹å›å½’ç§äººä½“éªŒã€‚
            </p>
            <div class="social-links">
              <a href="#" class="social-link">å¾®</a>
              <a href="#" class="social-link">å¾®</a>
              <a href="#" class="social-link">çŸ¥</a>
              <a href="#" class="social-link">æŠ–</a>
            </div>
          </div>
          <div class="footer-links">
            <h3>äº§å“</h3>
            <ul>
              <li><a href="#">åŠŸèƒ½ä»‹ç»</a></li>
              <li><a href="#">æŠ€æœ¯æ”¯æŒ</a></li>
              <li><a href="#">æ›´æ–°æ—¥å¿—</a></li>
              <li><a href="#">è·¯çº¿å›¾</a></li>
            </ul>
          </div>
          <div class="footer-links">
            <h3>èµ„æº</h3>
            <ul>
              <li><a href="#">ä½¿ç”¨æ–‡æ¡£</a></li>
              <li><a href="#">å¸¸è§é—®é¢˜</a></li>
              <li><a href="#">å¼€å‘è€…æ–‡æ¡£</a></li>
              <li><a href="#">APIæ¥å£</a></li>
            </ul>
          </div>
          <div class="footer-links">
            <h3>å…³äºæˆ‘ä»¬</h3>
            <ul>
              <li><a href="#">å›¢é˜Ÿä»‹ç»</a></li>
              <li><a href="#">è”ç³»æˆ‘ä»¬</a></li>
              <li><a href="#">åŠ å…¥æˆ‘ä»¬</a></li>
              <li><a href="#">éšç§æ”¿ç­–</a></li>
            </ul>
          </div>
        </div>
        <div class="copyright">&copy; 2024 dedicated-proç»„ç»‡ ç‰ˆæƒæ‰€æœ‰</div>
      </div>
    </footer>

    <!-- JavaScript -->
    <script type="module">
      // ç”±äºæ¨¡å—å¯¼å…¥åœ¨æ™®é€šHTMLä¸­éœ€è¦ç±»å‹ä¸ºmodule
      import AuthManager from "./js/auth.js";
      import MusicUploader from "./js/upload.js";
      import MusicPlayer from "./js/player.js";

      // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ‰€æœ‰æ¨¡å—
      document.addEventListener("DOMContentLoaded", () => {
        // åˆå§‹åŒ–è®¤è¯ç®¡ç†å™¨
        const authManager = new AuthManager();

        // åˆå§‹åŒ–éŸ³ä¹ä¸Šä¼ å™¨
        const musicUploader = new MusicUploader();

        // éŸ³ä¹æ’­æ”¾å™¨é…ç½®
        const playerConfig = {
          onSongEnd: () => {
            // æ’­æ”¾ä¸‹ä¸€é¦–
            if (currentPlaylist.length > 0) {
              if (currentIndex < currentPlaylist.length - 1) {
                currentIndex++;
              } else {
                currentIndex = 0; // å¾ªç¯æ’­æ”¾
              }
              musicPlayer.loadSong(currentPlaylist[currentIndex]);
              highlightCurrentSong();
            }
          },
        };

        // åˆå§‹åŒ–éŸ³ä¹æ’­æ”¾å™¨
        const musicPlayer = new MusicPlayer(playerConfig);

        // å­˜å‚¨å½“å‰æ’­æ”¾åˆ—è¡¨å’Œç´¢å¼•
        let currentPlaylist = [];
        let currentIndex = -1;

        // çƒ­é—¨å¹³å°æ­Œå•æ•°æ®
        const platformPlaylists = [
          {
            platform: "ç½‘æ˜“äº‘éŸ³ä¹",
            icon: "ğŸµ",
            playlists: [
              {
                name: "äº‘éŸ³ä¹çƒ­æ­Œæ¦œ",
                songs: [
                  {
                    title: "èµ·é£äº†",
                    artist: "ä¹°è¾£æ¤’ä¹Ÿç”¨åˆ¸",
                    album: "èµ·é£äº†",
                    duration: 325,
                  },
                  {
                    title: "ç¦»äºº",
                    artist: "éŸ³é˜™è¯—å¬/ç‹æ¢“é’°",
                    album: "ç¦»äºº",
                    duration: 215,
                  },
                  {
                    title: "è¿™ä¸€ç”Ÿå…³äºä½ çš„é£æ™¯",
                    artist: "éš”å£è€æ¨Š",
                    album: "è¿™ä¸€ç”Ÿå…³äºä½ çš„é£æ™¯",
                    duration: 285,
                  },
                ],
              },
              {
                name: "äº‘éŸ³ä¹é£™å‡æ¦œ",
                songs: [
                  {
                    title: "é›¨çˆ±",
                    artist: "åˆ˜å¤§å£®",
                    album: "é›¨çˆ±",
                    duration: 256,
                  },
                  {
                    title: "å¤šè¿œéƒ½è¦åœ¨ä¸€èµ·",
                    artist: "G.E.M.é‚“ç´«æ£‹",
                    album: "å¤šè¿œéƒ½è¦åœ¨ä¸€èµ·",
                    duration: 237,
                  },
                  {
                    title: "å¥å·",
                    artist: "G.E.M.é‚“ç´«æ£‹",
                    album: "å¥å·",
                    duration: 203,
                  },
                ],
              },
              {
                name: "è¯´å”±TOPæ¦œ",
                songs: [
                  {
                    title: "My New Swag",
                    artist: "VaVaæ¯›è¡ä¸ƒ",
                    album: "åˆ†è´",
                    duration: 185,
                  },
                  {
                    title: "Mojito",
                    artist: "å‘¨æ°ä¼¦",
                    album: "Mojito",
                    duration: 196,
                  },
                  {
                    title: "å§å§",
                    artist: "æé›ªç´",
                    album: "å§å§",
                    duration: 177,
                  },
                ],
              },
            ],
          },
          {
            platform: "QQéŸ³ä¹",
            icon: "ğŸ§",
            playlists: [
              {
                name: "æµè¡ŒæŒ‡æ•°æ¦œ",
                songs: [
                  {
                    title: "å…‰ç‚¹",
                    artist: "èƒ¡å½¦æ–Œ",
                    album: "å…‰ç‚¹",
                    duration: 267,
                  },
                  {
                    title: "æˆ‘å¾ˆå¥½ï¼ˆå‰ä»–ç‰ˆï¼‰",
                    artist: "åˆ˜å¤§å£®",
                    album: "æˆ‘å¾ˆå¥½",
                    duration: 218,
                  },
                  {
                    title: "è€—å°½",
                    artist: "è–›ä¹‹è°¦",
                    album: "è€—å°½",
                    duration: 261,
                  },
                ],
              },
              {
                name: "çƒ­æ­Œæ¦œ",
                songs: [
                  {
                    title: "ä½ çš„ç­”æ¡ˆ",
                    artist: "é˜¿å†—",
                    album: "ä½ çš„ç­”æ¡ˆ",
                    duration: 219,
                  },
                  {
                    title: "èµ¤ä¼¶",
                    artist: "HITA",
                    album: "èµ¤ä¼¶",
                    duration: 203,
                  },
                  {
                    title: "åƒé±¼",
                    artist: "ç‹è´°æµª",
                    album: "åƒé±¼",
                    duration: 216,
                  },
                ],
              },
              {
                name: "æ–°æ­Œæ¦œ",
                songs: [
                  {
                    title: "ä¸‹å±±",
                    artist: "è¦ä¸è¦ä¹°èœ",
                    album: "ä¸‹å±±",
                    duration: 192,
                  },
                  {
                    title: "ä¸–ç•Œè¿™ä¹ˆå¤§è¿˜æ˜¯é‡è§ä½ ",
                    artist: "ç¨‹å“",
                    album: "ä¸–ç•Œè¿™ä¹ˆå¤§è¿˜æ˜¯é‡è§ä½ ",
                    duration: 226,
                  },
                  {
                    title: "ç»¿è‰²",
                    artist: "é™ˆé›ªå‡",
                    album: "ç»¿è‰²",
                    duration: 269,
                  },
                ],
              },
            ],
          },
          {
            platform: "é…·ç‹—éŸ³ä¹",
            icon: "ğŸ¼",
            playlists: [
              {
                name: "é…·ç‹—TOP500",
                songs: [
                  {
                    title: "é‡å­",
                    artist: "è‹è¿è¹",
                    album: "é‡å­",
                    duration: 242,
                  },
                  {
                    title: "å¹´å°‘æœ‰ä¸º",
                    artist: "æè£æµ©",
                    album: "è€³æœµ",
                    duration: 253,
                  },
                  {
                    title: "èµ·é£äº†",
                    artist: "å´é’å³°",
                    album: "èµ·é£äº†",
                    duration: 314,
                  },
                ],
              },
              {
                name: "å†…åœ°æ¦œ",
                songs: [
                  {
                    title: "ç©ºç©ºå¦‚ä¹Ÿ",
                    artist: "èƒ¡66",
                    album: "ç©ºç©ºå¦‚ä¹Ÿ",
                    duration: 177,
                  },
                  {
                    title: "å‡è£…",
                    artist: "é™ˆé›ªå‡",
                    album: "å‡è£…",
                    duration: 213,
                  },
                  {
                    title: "å¯èƒ½å¦",
                    artist: "æœ¨å°é›…",
                    album: "å¯èƒ½å¦",
                    duration: 196,
                  },
                ],
              },
              {
                name: "ACGæ¦œ",
                songs: [
                  {
                    title: "å‹¾æŒ‡èµ·èª“",
                    artist: "æ³ é¸¢yousa",
                    album: "å‹¾æŒ‡èµ·èª“",
                    duration: 208,
                  },
                  {
                    title: "å¤§é­”ç‹",
                    artist: "æ³ é¸¢yousa",
                    album: "å¤§é­”ç‹",
                    duration: 173,
                  },
                  {
                    title: "æ˜¥æ—¥å½±",
                    artist: "åŒç¬™",
                    album: "æ˜¥æ—¥å½±",
                    duration: 245,
                  },
                ],
              },
            ],
          },
        ];

        // ç”¨æˆ·ç§äººæ­Œå•æ•°æ®
        const userPlaylists = [
          {
            name: "æœ€çˆ±æ”¶è—",
            songs: [
              {
                title: "æ˜¥é£åé‡Œ",
                artist: "é¹¿å…ˆæ£®ä¹é˜Ÿ",
                album: "æ‰€æœ‰çš„é…’ï¼Œéƒ½ä¸å¦‚ä½ ",
                duration: 328,
              },
              {
                title: "è«æ–¯ç§‘æ²¡æœ‰çœ¼æ³ª",
                artist: "æå¥",
                album: "ä¼¼æ°´æµå¹´",
                duration: 276,
              },
              {
                title: "æ¶ˆæ„",
                artist: "æ¯›ä¸æ˜“",
                album: "å¹³å‡¡çš„ä¸€å¤©",
                duration: 249,
              },
              {
                title: "èŠ’ç§",
                artist: "éŸ³é˜™è¯—å¬/èµµæ–¹å©§",
                album: "èŠ’ç§",
                duration: 216,
              },
              {
                title: "èµ·é£äº†",
                artist: "ä¹°è¾£æ¤’ä¹Ÿç”¨åˆ¸",
                album: "èµ·é£äº†",
                duration: 311,
              },
            ],
          },
          { name: "æµè¡Œçƒ­æ­Œ", songs: [] },
          { name: "è½»éŸ³ä¹", songs: [] },
          { name: "è¿åŠ¨åŠ¨åŠ›", songs: [] },
          { name: "å·¥ä½œä¸“æ³¨", songs: [] },
          { name: "ç¡å‰æ”¾æ¾", songs: [] },
        ];

        // åˆå§‹åŒ–æ­Œå•æ˜¾ç¤º
        updatePlaylistDisplay();

        // ç›‘å¬ç™»å½•çŠ¶æ€å˜åŒ–
        authManager.onLoginStateChanged = (isLoggedIn) => {
          updatePlaylistDisplay();

          // å¦‚æœç™»å‡ºï¼Œæ¸…ç©ºæ’­æ”¾åˆ—è¡¨
          if (!isLoggedIn) {
            currentPlaylist = [];
            currentIndex = -1;
            // æ¸…ç©ºæ­Œæ›²è¡¨æ ¼
            document.querySelector(".song-table tbody").innerHTML = "";
          }
        };

        // æ›´æ–°æ­Œå•æ˜¾ç¤º
        function updatePlaylistDisplay() {
          const isLoggedIn = authManager.isLoggedIn();
          const playlistContainer = document.querySelector(".playlist-sidebar");
          const sidebarTitle =
            playlistContainer.querySelector(".sidebar-title");
          const playlistList =
            playlistContainer.querySelector(".playlist-list");
          const playlistActions =
            playlistContainer.querySelector(".playlist-actions");

          // æ¸…ç©ºæ­Œå•åˆ—è¡¨
          playlistList.innerHTML = "";

          if (isLoggedIn) {
            // æ˜¾ç¤ºç”¨æˆ·ç§äººæ­Œå•
            sidebarTitle.textContent = "æˆ‘çš„æ­Œå•";
            playlistActions.style.display = "block";

            // æ·»åŠ ç”¨æˆ·æ­Œå•
            userPlaylists.forEach((playlist, index) => {
              const li = document.createElement("li");
              li.textContent = playlist.name;
              if (index === 0) li.classList.add("active");

              li.addEventListener("click", function () {
                selectPlaylist(this, playlist);
              });

              playlistList.appendChild(li);
            });

            // åˆå§‹åŠ è½½ç¬¬ä¸€ä¸ªæ­Œå•
            loadPlaylistSongs(userPlaylists[0]);
          } else {
            // æ˜¾ç¤ºçƒ­é—¨å¹³å°æ­Œå•
            sidebarTitle.textContent = "çƒ­é—¨æ¨èæ­Œå•";
            playlistActions.style.display = "none";

            // æ·»åŠ å¹³å°åˆ†ç±»
            platformPlaylists.forEach((platform) => {
              // æ·»åŠ å¹³å°æ ‡é¢˜
              const platformTitle = document.createElement("li");
              platformTitle.className = "platform-title";
              platformTitle.innerHTML = `${platform.icon} ${platform.platform}`;
              playlistList.appendChild(platformTitle);

              // æ·»åŠ è¯¥å¹³å°ä¸‹çš„æ­Œå•
              platform.playlists.forEach((playlist, index) => {
                const li = document.createElement("li");
                li.textContent = playlist.name;
                li.classList.add("platform-playlist");
                if (platform === platformPlaylists[0] && index === 0) {
                  li.classList.add("active");
                }

                li.addEventListener("click", function () {
                  selectPlaylist(this, playlist);
                });

                playlistList.appendChild(li);
              });
            });

            // åˆå§‹åŠ è½½ç¬¬ä¸€ä¸ªå¹³å°çš„ç¬¬ä¸€ä¸ªæ­Œå•
            loadPlaylistSongs(platformPlaylists[0].playlists[0]);
          }
        }

        // é€‰æ‹©æ­Œå•
        function selectPlaylist(element, playlist) {
          // æ›´æ–°UIé€‰ä¸­çŠ¶æ€
          document.querySelectorAll(".playlist-list li").forEach((item) => {
            item.classList.remove("active");
          });
          element.classList.add("active");

          // æ›´æ–°æ ‡é¢˜
          document.querySelector(".song-header h3").textContent = playlist.name;

          // åŠ è½½æ­Œå•æ­Œæ›²
          loadPlaylistSongs(playlist);
        }

        // åŠ è½½æ­Œå•æ­Œæ›²
        function loadPlaylistSongs(playlist) {
          const tbody = document.querySelector(".song-table tbody");
          tbody.innerHTML = "";

          // æ¸…ç©ºå½“å‰æ’­æ”¾åˆ—è¡¨
          currentPlaylist = [];
          currentIndex = -1;

          if (!playlist.songs || playlist.songs.length === 0) {
            // æ­Œå•ä¸ºç©º
            return;
          }

          // æ·»åŠ æ­Œæ›²åˆ°è¡¨æ ¼
          playlist.songs.forEach((song, index) => {
            const row = document.createElement("tr");

            // æ ¼å¼åŒ–æ—¶é•¿
            const mins = Math.floor(song.duration / 60);
            const secs = Math.floor(song.duration % 60);
            const formattedDuration = `${mins}:${secs < 10 ? "0" : ""}${secs}`;

            row.innerHTML = `
              <td>${index + 1}</td>
              <td>${song.title}</td>
              <td>${song.artist}</td>
              <td>${song.album}</td>
              <td>${formattedDuration}</td>
              <td>â™¡</td>
            `;

            // ä¸ºæ¯é¦–æ­Œåˆ›å»ºæ¨¡æ‹Ÿçš„æ’­æ”¾URLï¼ˆå®é™…é¡¹ç›®ä¸­åº”è¯¥æœ‰çœŸå®URLï¼‰
            const simulatedSong = {
              ...song,
              url: `#${song.title.replace(/\s/g, "_")}`, // æ¨¡æ‹ŸURL
              id: Date.now() + index,
            };

            // æ·»åŠ åˆ°å½“å‰æ’­æ”¾åˆ—è¡¨
            currentPlaylist.push(simulatedSong);

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            row.addEventListener("click", function () {
              // è·å–å½“å‰æ­Œæ›²åœ¨åˆ—è¡¨ä¸­çš„ç´¢å¼•
              const songIndex = Array.from(tbody.children).indexOf(this);
              currentIndex = songIndex;

              // ä½¿ç”¨MusicPlayeråŠ è½½å¹¶æ’­æ”¾æ­Œæ›²
              // ç”±äºæˆ‘ä»¬æ²¡æœ‰çœŸå®çš„éŸ³é¢‘æ–‡ä»¶ï¼Œè¿™é‡Œä¼šå°è¯•æ’­æ”¾ä½†å®é™…ä¸ä¼šæœ‰å£°éŸ³
              // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œåº”è¯¥æä¾›çœŸå®çš„éŸ³é¢‘URL
              musicPlayer.loadSong(currentPlaylist[currentIndex]);
              highlightCurrentSong();
            });

            tbody.appendChild(row);
          });
        }

        // éŸ³ä¹ä¸Šä¼ æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document
          .getElementById("upload-music-btn")
          .addEventListener("click", (e) => {
            e.preventDefault();

            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            if (!authManager.isLoggedIn()) {
              alert("è¯·å…ˆç™»å½•åå†ä¸Šä¼ éŸ³ä¹");
              // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
              authManager.showLoginModal();
              return;
            }

            // å·²ç™»å½•ï¼Œè°ƒç”¨ä¸Šä¼ åŠŸèƒ½
            musicUploader.showFileSelector((uploadedSongs) => {
              // ä¸Šä¼ æˆåŠŸåï¼Œæ·»åŠ åˆ°å½“å‰æ­Œå•
              console.log("æˆåŠŸä¸Šä¼ éŸ³ä¹æ–‡ä»¶:", uploadedSongs);

              // æ›´æ–°ç•Œé¢
              updateSongTable(uploadedSongs);

              // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
              alert(`æˆåŠŸä¸Šä¼  ${uploadedSongs.length} é¦–æ­Œæ›²åˆ°å½“å‰æ­Œå•ï¼`);
            });
          });

        // æ·»åŠ æ­Œæ›²æŒ‰é’®ä¹Ÿéœ€è¦ç™»å½•éªŒè¯
        document
          .getElementById("add-song-btn")
          .addEventListener("click", () => {
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            if (!authManager.isLoggedIn()) {
              alert("è¯·å…ˆç™»å½•åå†æ·»åŠ æ­Œæ›²");
              // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
              authManager.showLoginModal();
              return;
            }

            // å·²ç™»å½•ï¼Œè°ƒç”¨ä¸Šä¼ åŠŸèƒ½
            musicUploader.showFileSelector((uploadedSongs) => {
              // ä¸Šä¼ æˆåŠŸåï¼Œæ·»åŠ åˆ°å½“å‰æ­Œå•
              console.log("æˆåŠŸæ·»åŠ éŸ³ä¹æ–‡ä»¶:", uploadedSongs);

              // æ›´æ–°ç•Œé¢
              updateSongTable(uploadedSongs);

              // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
              alert(`æˆåŠŸæ·»åŠ  ${uploadedSongs.length} é¦–æ­Œæ›²åˆ°å½“å‰æ­Œå•ï¼`);
            });
          });

        // åˆ›å»ºæ–°æ­Œå•æŒ‰é’®äº‹ä»¶
        document
          .getElementById("create-playlist-btn")
          .addEventListener("click", () => {
            // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
            if (!authManager.isLoggedIn()) {
              alert("è¯·å…ˆç™»å½•åå†åˆ›å»ºæ­Œå•");
              // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
              authManager.showLoginModal();
              return;
            }

            // æ˜¾ç¤ºåˆ›å»ºæ­Œå•å¯¹è¯æ¡†
            const modal = document.getElementById("create-playlist-modal");
            modal.style.display = "block";
          });

        // å…³é—­æ¨¡æ€æ¡†äº‹ä»¶
        document
          .querySelectorAll(".close-button, .cancel-btn")
          .forEach((element) => {
            element.addEventListener("click", () => {
              document.getElementById("create-playlist-modal").style.display =
                "none";
            });
          });

        // åˆ›å»ºæ­Œå•è¡¨å•æäº¤
        document
          .getElementById("create-playlist-form")
          .addEventListener("submit", (e) => {
            e.preventDefault();

            const playlistName = document.getElementById("playlist-name").value;
            const playlistDesc = document.getElementById("playlist-desc").value;

            if (!playlistName.trim()) {
              alert("æ­Œå•åç§°ä¸èƒ½ä¸ºç©ºï¼");
              return;
            }

            // åˆ›å»ºæ–°æ­Œå•
            addPlaylistToUI(playlistName);
            document.getElementById("playlist-name").value = "";
            document.getElementById("playlist-desc").value = "";
            document.getElementById("create-playlist-modal").style.display =
              "none";

            // æ·»åŠ åˆ°ç”¨æˆ·æ­Œå•æ•°æ®
            userPlaylists.push({
              name: playlistName,
              description: playlistDesc,
              songs: [],
            });
          });

        // æ‰‹åŠ¨æ·»åŠ æ­Œå•åˆ°UI
        function addPlaylistToUI(name) {
          const li = document.createElement("li");
          li.textContent = name;
          li.addEventListener("click", function () {
            document
              .querySelectorAll(".playlist-list li")
              .forEach((item) => item.classList.remove("active"));
            this.classList.add("active");
            document.querySelector(".song-header h3").textContent = name;

            // æ¸…ç©ºæ­Œæ›²åˆ—è¡¨ï¼ˆæ–°å»ºçš„æ­Œå•æ²¡æœ‰æ­Œæ›²ï¼‰
            document.querySelector(".song-table tbody").innerHTML = "";

            // æ¸…ç©ºå½“å‰æ’­æ”¾åˆ—è¡¨
            currentPlaylist = [];
            currentIndex = -1;
          });
          document.querySelector(".playlist-list").appendChild(li);
        }

        // æ›´æ–°æ­Œæ›²è¡¨æ ¼
        function updateSongTable(songs) {
          if (!songs || songs.length === 0) return;

          const tbody = document.querySelector(".song-table tbody");

          // æ·»åŠ æ–°ä¸Šä¼ çš„æ­Œæ›²
          songs.forEach((song, index) => {
            const row = document.createElement("tr");

            // æ ¼å¼åŒ–æ—¶é•¿ï¼ˆç§’è½¬mm:ssï¼‰
            const duration = song.duration || 0;
            const mins = Math.floor(duration / 60);
            const secs = Math.floor(duration % 60);
            const formattedDuration = `${mins}:${secs < 10 ? "0" : ""}${secs}`;

            row.innerHTML = `
              <td>${tbody.children.length + index + 1}</td>
              <td>${song.title}</td>
              <td>${song.artist}</td>
              <td>${song.album}</td>
              <td>${formattedDuration}</td>
              <td>â™¡</td>
            `;

            // æ·»åŠ åˆ°å½“å‰æ’­æ”¾åˆ—è¡¨
            currentPlaylist.push(song);

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            row.addEventListener("click", function () {
              // è·å–å½“å‰æ­Œæ›²åœ¨åˆ—è¡¨ä¸­çš„ç´¢å¼•
              const songIndex = Array.from(tbody.children).indexOf(this);
              currentIndex = songIndex;

              // ä½¿ç”¨MusicPlayeråŠ è½½å¹¶æ’­æ”¾æ­Œæ›²
              musicPlayer.loadSong(currentPlaylist[currentIndex]);
              highlightCurrentSong();
            });

            tbody.appendChild(row);

            // æ·»åŠ åˆ°å½“å‰é€‰ä¸­çš„ç”¨æˆ·æ­Œå•æ•°æ®ä¸­
            const activePlaylistName = document.querySelector(
              ".playlist-list li.active"
            ).textContent;
            const userPlaylist = userPlaylists.find(
              (playlist) => playlist.name === activePlaylistName
            );
            if (userPlaylist) {
              userPlaylist.songs.push(song);
            }
          });
        }

        // æ§åˆ¶æŒ‰é’®äº‹ä»¶å¤„ç†
        const playButton = document.querySelector(
          ".player-controls .control-btn:nth-child(2)"
        );
        const prevButton = document.querySelector(
          ".player-controls .control-btn:nth-child(1)"
        );
        const nextButton = document.querySelector(
          ".player-controls .control-btn:nth-child(3)"
        );

        // æ’­æ”¾/æš‚åœæŒ‰é’® - éœ€è¦åœ¨è¿™é‡Œç»‘å®šäº‹ä»¶ï¼Œå› ä¸ºåœ¨MusicPlayerç±»ä¸­å·²å­˜åœ¨é‡å¤ç»‘å®š
        playButton.addEventListener("click", () => {
          if (currentIndex >= 0 && currentPlaylist.length > 0) {
            // å¦‚æœå½“å‰æœ‰æ­Œæ›²æ­£åœ¨æ’­æ”¾ï¼Œåˆ™åˆ‡æ¢æ’­æ”¾/æš‚åœçŠ¶æ€
            musicPlayer.togglePlay();
          } else if (currentPlaylist.length > 0) {
            // å¦‚æœæœ‰æ­Œæ›²ä½†æ²¡æœ‰æ’­æ”¾ï¼Œæ’­æ”¾ç¬¬ä¸€é¦–
            currentIndex = 0;
            musicPlayer.loadSong(currentPlaylist[currentIndex]);
            highlightCurrentSong();
          }
        });

        // ä¸Šä¸€é¦–æŒ‰é’®
        prevButton.addEventListener("click", () => {
          if (currentPlaylist.length > 0) {
            if (currentIndex > 0) {
              currentIndex--;
            } else {
              // å¾ªç¯åˆ°æœ€åä¸€é¦–
              currentIndex = currentPlaylist.length - 1;
            }
            musicPlayer.loadSong(currentPlaylist[currentIndex]);

            // é«˜äº®æ˜¾ç¤ºå½“å‰æ’­æ”¾çš„æ­Œæ›²è¡Œ
            highlightCurrentSong();
          }
        });

        // ä¸‹ä¸€é¦–æŒ‰é’®
        nextButton.addEventListener("click", () => {
          if (currentPlaylist.length > 0) {
            if (currentIndex < currentPlaylist.length - 1) {
              currentIndex++;
            } else {
              // å¾ªç¯åˆ°ç¬¬ä¸€é¦–
              currentIndex = 0;
            }
            musicPlayer.loadSong(currentPlaylist[currentIndex]);

            // é«˜äº®æ˜¾ç¤ºå½“å‰æ’­æ”¾çš„æ­Œæ›²è¡Œ
            highlightCurrentSong();
          }
        });

        // é«˜äº®æ˜¾ç¤ºå½“å‰æ’­æ”¾çš„æ­Œæ›²è¡Œ
        function highlightCurrentSong() {
          const rows = document.querySelectorAll(".song-table tbody tr");
          rows.forEach((row, index) => {
            if (index === currentIndex) {
              row.classList.add("playing");
            } else {
              row.classList.remove("playing");
            }
          });
        }

        // é¢„åŠ è½½musicæ–‡ä»¶å¤¹ä¸­çš„éŸ³ä¹
        function preloadLocalMusic() {
          if (authManager.isLoggedIn()) {
            const musicFiles = [
              {
                name: "call of silence.mp3",
                path: "music/call of silence.mp3",
              },
              {
                name: "è¾¾å°”æ–‡-æ—ä¿Šæ°-JJçš„å’–å•¡è°ƒè°ƒ.mp3",
                path: "music/è¾¾å°”æ–‡-æ—ä¿Šæ°-JJçš„å’–å•¡è°ƒè°ƒ.mp3",
              },
            ];

            // åŠ è½½ç¬¬ä¸€é¦–æ­Œæ›²
            fetch(musicFiles[0].path)
              .then((response) => response.blob())
              .then((blob) => {
                const file1 = new File([blob], musicFiles[0].name, {
                  type: "audio/mpeg",
                });

                // åŠ è½½ç¬¬äºŒé¦–æ­Œæ›²
                return fetch(musicFiles[1].path)
                  .then((response) => response.blob())
                  .then((blob) => {
                    const file2 = new File([blob], musicFiles[1].name, {
                      type: "audio/mpeg",
                    });
                    return [file1, file2];
                  });
              })
              .then((files) => {
                // å¤„ç†æ–‡ä»¶
                musicUploader.processFiles(files).then((songs) => {
                  updateSongTable(songs);
                  console.log("æˆåŠŸåŠ è½½æœ¬åœ°éŸ³ä¹æ–‡ä»¶", songs);
                });
              })
              .catch((error) => {
                console.error("åŠ è½½æœ¬åœ°éŸ³ä¹æ–‡ä»¶å¤±è´¥:", error);
              });
          }
        }

        // è‡ªåŠ¨åŠ è½½æœ¬åœ°éŸ³ä¹
        document
          .getElementById("add-song-btn")
          .addEventListener("click", function () {
            if (authManager.isLoggedIn()) {
              preloadLocalMusic();
            }
          });
      });
    </script>
    <script src="js/main.js"></script>
  </body>
</html>
